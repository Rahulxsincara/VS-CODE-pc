<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Test | My Library</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }
        
        .error-box {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        
        .user-list {
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #1976d2;
        }
        
        .delete-btn {
            background: #f44336;
        }
        
        .delete-btn:hover {
            background: #d32f2f;
        }
        
        .admin-btn {
            background: #9c27b0;
        }
        
        .admin-btn:hover {
            background: #7b1fa2;
        }
        
        .action-btn {
            padding: 5px 10px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-user-shield"></i> Admin Functionality Test</h1>
        
        <div class="info-box">
            <h3>Admin Credentials</h3>
            <p><strong>Username:</strong> Administrator</p>
            <p><strong>Student ID:</strong> admin</p>
            <p><strong>Password:</strong> admin123</p>
            <p><em>Note: Please change the default password after first login for security.</em></p>
        </div>
        
        <div id="status" class="info-box">
            <p>Checking admin user status...</p>
        </div>
        
        <div id="actions" style="text-align: center; margin: 30px 0;">
            <button id="checkAdmin"><i class="fas fa-search"></i> Check Admin Status</button>
            <button id="createAdmin" class="admin-btn"><i class="fas fa-user-plus"></i> Create/Reset Admin</button>
            <button id="viewUsers" class="admin-btn"><i class="fas fa-users"></i> View All Users</button>
            <button id="goToAdmin" class="admin-btn"><i class="fas fa-tachometer-alt"></i> Go to Admin Dashboard</button>
            <button id="goToLogin"><i class="fas fa-sign-in-alt"></i> Go to Login Page</button>
        </div>
        
        <div id="userList" class="user-list" style="display: none;">
            <h3>User List</h3>
            <table id="usersTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Student ID</th>
                        <th>Year</th>
                        <th>Registered</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // DOM Elements
        const statusDiv = document.getElementById('status');
        const userListDiv = document.getElementById('userList');
        const usersTableBody = document.getElementById('usersTableBody');
        
        // Check admin status on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminStatus();
        });
        
        // Event listeners for buttons
        document.getElementById('checkAdmin').addEventListener('click', checkAdminStatus);
        document.getElementById('createAdmin').addEventListener('click', createAdminUser);
        document.getElementById('viewUsers').addEventListener('click', viewAllUsers);
        document.getElementById('goToAdmin').addEventListener('click', () => {
            window.location.href = 'admin.html';
        });
        document.getElementById('goToLogin').addEventListener('click', () => {
            window.location.href = 'login.html';
        });
        
        // Check if admin user exists
        function checkAdminStatus() {
            try {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const adminUser = users.find(user => user.studentId === 'admin');
                
                if (adminUser) {
                    statusDiv.className = 'info-box success-box';
                    statusDiv.innerHTML = `
                        <h3>Admin User Found</h3>
                        <p><strong>Name:</strong> ${adminUser.name}</p>
                        <p><strong>Student ID:</strong> ${adminUser.studentId}</p>
                        <p><strong>Registration Date:</strong> ${new Date(adminUser.registered).toLocaleString()}</p>
                        <p>Status: <span style="color: green;">READY</span></p>
                    `;
                } else {
                    statusDiv.className = 'info-box error-box';
                    statusDiv.innerHTML = `
                        <h3>Admin User Not Found</h3>
                        <p>No admin user exists in the system.</p>
                        <p>Status: <span style="color: red;">NOT CONFIGURED</span></p>
                        <button onclick="createAdminUser()" class="admin-btn"><i class="fas fa-user-plus"></i> Create Admin User</button>
                    `;
                }
            } catch (error) {
                statusDiv.className = 'info-box error-box';
                statusDiv.innerHTML = `
                    <h3>Error</h3>
                    <p>Failed to check admin status: ${error.message}</p>
                `;
            }
        }
        
        // Create or reset admin user
        function createAdminUser() {
            try {
                let users = JSON.parse(localStorage.getItem('users') || '[]');
                
                // Remove existing admin user if exists
                users = users.filter(user => user.studentId !== 'admin');
                
                // Create new admin user
                const adminUser = {
                    id: 'admin-' + Date.now(),
                    name: 'Administrator',
                    studentId: 'admin',
                    password: 'admin123',
                    year: '4',
                    registered: new Date().toISOString(),
                    lastLogin: null
                };
                
                users.push(adminUser);
                localStorage.setItem('users', JSON.stringify(users));
                
                statusDiv.className = 'info-box success-box';
                statusDiv.innerHTML = `
                    <h3>Admin User Created</h3>
                    <p>Admin user has been successfully created/reset.</p>
                    <p><strong>Username:</strong> Administrator</p>
                    <p><strong>Student ID:</strong> admin</p>
                    <p><strong>Password:</strong> admin123</p>
                    <p style="color: #f44336;"><strong>Please change the password after first login!</strong></p>
                `;
            } catch (error) {
                statusDiv.className = 'info-box error-box';
                statusDiv.innerHTML = `
                    <h3>Error</h3>
                    <p>Failed to create admin user: ${error.message}</p>
                `;
            }
        }
        
        // View all users
        function viewAllUsers() {
            try {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                
                if (users.length === 0) {
                    userListDiv.style.display = 'block';
                    usersTableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No users found</td></tr>';
                    return;
                }
                
                // Clear table
                usersTableBody.innerHTML = '';
                
                // Add users to table
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.name}</td>
                        <td>${user.studentId}</td>
                        <td>Year ${user.year}</td>
                        <td>${new Date(user.registered).toLocaleDateString()}</td>
                        <td>
                            ${user.studentId === 'admin' ? 
                                '<span style="color: #9c27b0;">Administrator</span>' : 
                                `<button class="action-btn delete-btn" onclick="deleteUser('${user.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>`}
                        </td>
                    `;
                    usersTableBody.appendChild(row);
                });
                
                userListDiv.style.display = 'block';
            } catch (error) {
                statusDiv.className = 'info-box error-box';
                statusDiv.innerHTML = `
                    <h3>Error</h3>
                    <p>Failed to load users: ${error.message}</p>
                `;
            }
        }
        
        // Delete user
        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                try {
                    let users = JSON.parse(localStorage.getItem('users') || '[]');
                    users = users.filter(user => user.id !== userId);
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    // Refresh user list
                    viewAllUsers();
                    
                    // Show success message
                    statusDiv.className = 'info-box success-box';
                    statusDiv.innerHTML = '<h3>Success</h3><p>User deleted successfully.</p>';
                    
                    // Auto-hide message after 3 seconds
                    setTimeout(checkAdminStatus, 3000);
                } catch (error) {
                    statusDiv.className = 'info-box error-box';
                    statusDiv.innerHTML = `
                        <h3>Error</h3>
                        <p>Failed to delete user: ${error.message}</p>
                    `;
                }
            }
        }
    </script>
</body>
</html>